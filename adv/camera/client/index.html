<!DOCTYPE html>
<html lang="en">

<head>
    <title> sekeleton </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>

<body>


    <div>
        <canvas id="mainCanvas" width="640" height="480">
        </canvas>
    </div>

    <div>
        <input id="cam_url" value="http://redstar002.iptime.org:20081/">
        <button id="btn-start"> start </button>
    </div>

    <script>

        var canvas = document.getElementById('mainCanvas');
        var ctx = canvas.getContext('2d');


        document.querySelector("#btn-start").addEventListener('click', _ => {

            isLoop=true
            _loop()

        })

        let isLoop = false
        function _loop() {

            let _url = document.querySelector('#cam_url').value;
            // fetch('http://redstar002.iptime.org:20081/')
            fetch(`${_url}`)
                .then(response => response.blob())
                .then(images => {
                    // console.log(images)

                    var img = new Image();

                    img.onload = (_) => {
                        ctx.drawImage(_.target, 0, 0, 640, 480)
                    }

                    img.src = URL.createObjectURL(images)

                    if(isLoop) {
                        setTimeout(_loop,500)
                    }
                    // Then create a local URL for that image and print it 
                    // outside = URL.createObjectURL(images)
                    // console.log(outside)
                });
                
        }

    </script>




</body>

</html>